<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.portfo.web.repository.MemberRepository">
	
	<select id="findByUid" resultType="Member">
		select
			*
		from
			member
		where
			username = '${uid}' 
	</select>
	
	<!-- 회원가입 -->
	<insert id="insert" parameterType="Member">
		insert into member
		(username,pwd,nickname,email, gender_id, career)
		values(#{username},#{pwd},#{nickname},#{email},#{genderId},#{career})
	</insert>
	
	<!-- 기존 가입된 이메일인지 확인 -->
	<select id="countEmail" resultType="int">
		select
			count(id)
		from
			member
		where
			email = #{email}
	</select>
	
	<select id="findId" parameterType="String" resultType="String">
		select 
			username 
		from 
			member 
		where 
			email = #{email}
	</select>
	
	<select id="findById" resultType="Member">
		select
			*
		from
			member
		where
			id = #{id} 
	</select>
	
	<!-- 사용자 정보 업데이트 -->
	<update id="update" parameterType="Member">
		update member
		<trim prefix="SET" suffixOverrides=",">
			<if test="nickname != null and nickname != ''">nickname=#{nickname},</if>
			<if test="pwd != null and pwd != ''">pwd=#{pwd},</if>
			<if test="email != null and email != ''">email=#{email},</if>
			<if test="url != null and url != ''">url=#{url}</if>
		</trim>
		where id = #{id};
	</update>
	
	<update id="insertUUID" parameterType="String">
		update 
			member 
		set 
			uuid = #{uuid}
		where 
			email = #{email};
	</update>
	
	<select id="findUUID" resultType="String" parameterType="String">
		
		select
			uuid
		from
			member
		where
			email = #{email};
	</select>
	
	
	<update id="updatePwd" parameterType="String">
		update
			member
		set
			pwd = #{pwd},
			uuid = ''
		where
			email = #{email};
	</update>

	<select id="countId" resultType="int">
		select
			count(id)
		from
			member
		where
			username = '${uid}'
	</select>

</mapper>